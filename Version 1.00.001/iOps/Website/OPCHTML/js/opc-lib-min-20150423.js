var Hashtable=function(){function n(t){var r;if(typeof t=="string")return t;if(typeof t.hashCode==e)return r=t.hashCode(),typeof r=="string"?r:n(r);if(typeof t.toString==e)return t.toString();try{return String(t)}catch(i){return Object.prototype.toString.call(t)}}function r(e,t){return e.equals(t)}function i(t,n){return typeof n.equals==e?n.equals(t):t===n}function s(e){return function(t){if(t===null)throw new Error("null is not a valid "+e);if(typeof t=="undefined")throw new Error(e+" must not be undefined")}}function a(e,t,n,r){this[0]=e,this.entries=[],this.addEntry(t,n),r!==null&&(this.getEqualityFunction=function(){return r})}function h(e){return function(t){var n=this.entries.length,r,i=this.getEqualityFunction(t);while(n--){r=this.entries[n];if(i(t,r[0]))switch(e){case f:return!0;case l:return r;case c:return[n,r[1]]}}return!1}}function p(e){return function(t){var n=t.length;for(var r=0,i=this.entries.length;r<i;++r)t[n+r]=this.entries[r][e]}}function d(e,t){var n=e.length,r;while(n--){r=e[n];if(t===r[0])return n}return null}function v(e,t){var n=e[t];return n&&n instanceof a?n:null}function m(r,i){var s=this,f=[],l={},c=typeof r==e?r:n,h=typeof i==e?i:null;this.put=function(e,t){o(e),u(t);var n=c(e),r,i,s=null;return r=v(l,n),r?(i=r.getEntryForKey(e),i?(s=i[1],i[1]=t):r.addEntry(e,t)):(r=new a(n,e,t,h),f[f.length]=r,l[n]=r),s},this.get=function(e){o(e);var t=c(e),n=v(l,t);if(n){var r=n.getEntryForKey(e);if(r)return r[1]}return null},this.containsKey=function(e){o(e);var t=c(e),n=v(l,t);return n?n.containsKey(e):!1},this.containsValue=function(e){u(e);var t=f.length;while(t--)if(f[t].containsValue(e))return!0;return!1},this.clear=function(){f.length=0,l={}},this.isEmpty=function(){return!f.length};var p=function(e){return function(){var t=[],n=f.length;while(n--)f[n][e](t);return t}};this.keys=p("keys"),this.values=p("values"),this.entries=p("getEntries"),this.remove=function(e){o(e);var n=c(e),r,i=null,s=v(l,n);return s&&(i=s.removeEntryForKey(e),i!==null&&(s.entries.length||(r=d(f,n),t(f,r),delete l[n]))),i},this.size=function(){var e=0,t=f.length;while(t--)e+=f[t].entries.length;return e},this.each=function(e){var t=s.entries(),n=t.length,r;while(n--)r=t[n],e(r[0],r[1])},this.putAll=function(t,n){var r=t.entries(),i,o,u,a,f=r.length,l=typeof n==e;while(f--)i=r[f],o=i[0],u=i[1],l&&(a=s.get(o))&&(u=n(o,a,u)),s.put(o,u)},this.clone=function(){var e=new m(r,i);return e.putAll(s),e}}var e="function",t=typeof Array.prototype.splice==e?function(e,t){e.splice(t,1)}:function(e,t){var n,r,i;if(t===e.length-1)e.length=t;else{n=e.slice(t+1),e.length=t;for(r=0,i=n.length;r<i;++r)e[t+r]=n[r]}},o=s("key"),u=s("value"),f=0,l=1,c=2;return a.prototype={getEqualityFunction:function(t){return typeof t.equals==e?r:i},getEntryForKey:h(l),getEntryAndIndexForKey:h(c),removeEntryForKey:function(e){var n=this.getEntryAndIndexForKey(e);return n?(t(this.entries,n[0]),n[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]},keys:p(0),values:p(1),getEntries:function(e){var t=e.length;for(var n=0,r=this.entries.length;n<r;++n)e[t+n]=this.entries[n].slice(0)},containsKey:h(f),containsValue:function(e){var t=this.entries.length;while(t--)if(e===this.entries[t][1])return!0;return!1}},m}();(function(e){function a(e,t,n){this.dec=e,this.group=t,this.neg=n}function f(){for(var e=0;e<u.length;e++){localeGroup=u[e];for(var n=0;n<localeGroup.length;n++)t.put(localeGroup[n],e)}}function l(e,n){t.size()==0&&f();var r=".",i=",",s="-";n==0&&(e.indexOf("_")!=-1?e=e.split("_")[1].toLowerCase():e.indexOf("-")!=-1&&(e=e.split("-")[1].toLowerCase()));var u=t.get(e);if(u){var l=o[u];l&&(r=l[0],i=l[1])}return new a(r,i,s)}var t=new Hashtable,n=["ae","au","ca","cn","eg","gb","hk","il","in","jp","sk","th","tw","us"],r=["at","br","de","dk","es","gr","it","nl","pt","tr","vn"],i=["cz","fi","fr","ru","se","pl"],s=["ch"],o=[[".",","],[",","."],[","," "],[".","'"]],u=[n,r,i,s];e.fn.formatNumber=function(t,n,r){return this.each(function(){n==null&&(n=!0),r==null&&(r=!0);var i;e(this).is(":input")?i=new String(e(this).val()):i=new String(e(this).text());var s=e.formatNumber(i,t);n&&(e(this).is(":input")?e(this).val(s):e(this).text(s));if(r)return s})},e.formatNumber=function(t,n){var n=e.extend({},e.fn.formatNumber.defaults,n),r=l(n.locale.toLowerCase(),n.isFullLocale),i=r.dec,s=r.group,o=r.neg,u="0#-,.",a="",f=!1;for(var c=0;c<n.format.length;c++){if(u.indexOf(n.format.charAt(c))!=-1){if(c==0&&n.format.charAt(c)=="-"){f=!0;continue}break}a+=n.format.charAt(c)}var h="";for(var c=n.format.length-1;c>=0;c--){if(u.indexOf(n.format.charAt(c))!=-1)break;h=n.format.charAt(c)+h}n.format=n.format.substring(a.length),n.format=n.format.substring(0,n.format.length-h.length);var p=new Number(t);return e._formatNumber(p,n,h,a,f)},e._formatNumber=function(t,n,r,i,s){var n=e.extend({},e.fn.formatNumber.defaults,n),o=l(n.locale.toLowerCase(),n.isFullLocale),u=o.dec,a=o.group,f=o.neg,c=!1;if(isNaN(t)){if(n.nanForceZero!=1)return null;t=0,c=!0}r=="%"&&(t*=100);var h="";if(n.format.indexOf(".")>-1){var p=u,d=n.format.substring(n.format.lastIndexOf(".")+1);if(n.round==1)t=new Number(t.toFixed(d.length));else{var v=t.toString();v=v.substring(0,v.lastIndexOf(".")+d.length+1),t=new Number(v)}var m=t%1,g=new String(m.toFixed(d.length));g=g.substring(g.lastIndexOf(".")+1);for(var y=0;y<d.length;y++){if(d.charAt(y)=="#"&&g.charAt(y)!="0"){p+=g.charAt(y);continue}if(d.charAt(y)=="#"&&g.charAt(y)=="0"){var b=g.substring(y);if(b.match("[1-9]")){p+=g.charAt(y);continue}break}d.charAt(y)=="0"&&(p+=g.charAt(y))}h+=p}else t=Math.round(t);var w=Math.floor(t);t<0&&(w=Math.ceil(t));var E="";n.format.indexOf(".")==-1?E=n.format:E=n.format.substring(0,n.format.indexOf("."));var S="";if(w!=0||E.substr(E.length-1)!="#"||c){var x=new String(Math.abs(w)),T=9999;E.lastIndexOf(",")!=-1&&(T=E.length-E.lastIndexOf(",")-1);var N=0;for(var y=x.length-1;y>-1;y--)S=x.charAt(y)+S,N++,N==T&&y!=0&&(S=a+S,N=0);if(E.length>S.length){var C=E.indexOf("0");if(C!=-1){var L=E.length-
C,A=E.length-S.length-1;while(S.length<L){var O=E.charAt(A);O==","&&(O=a),S=O+S,A--}}}}return!S&&E.indexOf("0",E.length-1)!==-1&&(S="0"),h=S+h,t<0&&s&&i.length>0?i=f+i:t<0&&(h=f+h),n.decimalSeparatorAlwaysShown||h.lastIndexOf(u)==h.length-1&&(h=h.substring(0,h.length-1)),h=i+h+r,h},e.fn.parseNumber=function(t,n,r){n==null&&(n=!0),r==null&&(r=!0);var i;e(this).is(":input")?i=new String(e(this).val()):i=new String(e(this).text());var s=e.parseNumber(i,t);if(s){n&&(e(this).is(":input")?e(this).val(s.toString()):e(this).text(s.toString()));if(r)return s}},e.parseNumber=function(t,n){var n=e.extend({},e.fn.parseNumber.defaults,n),r=l(n.locale.toLowerCase(),n.isFullLocale),i=r.dec,s=r.group,o=r.neg,u="1234567890.-";while(t.indexOf(s)>-1)t=t.replace(s,"");t=t.replace(i,".").replace(o,"-");var a="",f=!1;if(t.charAt(t.length-1)=="%"||n.isPercentage==1)f=!0;for(var c=0;c<t.length;c++)u.indexOf(t.charAt(c))>-1&&(a+=t.charAt(c));var h=new Number(a);if(f){h/=100;var p=a.indexOf(".");if(p!=-1){var d=a.length-p-1;h=h.toFixed(d+2)}else h=h.toFixed(a.length-1)}return h},e.fn.parseNumber.defaults={locale:"us",decimalSeparatorAlwaysShown:!1,isPercentage:!1,isFullLocale:!1},e.fn.formatNumber.defaults={format:"#,###.00",locale:"us",decimalSeparatorAlwaysShown:!1,nanForceZero:!0,round:!0,isFullLocale:!1},Number.prototype.toFixed=function(t){return e._roundNumber(this,t)},e._roundNumber=function(e,t){var n=Math.pow(10,t||0),r=String(Math.round(e*n)/n);if(t>0){var i=r.indexOf(".");i==-1?(r+=".",i=0):i=r.length-(i+1);while(i<t)r+="0",i++}return r}})(jQuery),function(){var e=this;$(document).ready(function(){return OPC.init()}),jQuery.fn.center=function(){return this.css("position","absolute"),this.css("top",($(window).height()-this.outerHeight())/2+$(window).scrollTop()+"px"),this.css("left",($(window).width()-this.outerWidth())/2+$(window).scrollLeft()+"px"),this},window.OPC={version:"1.9.9",debug:!0,debug_refresh:!1,tags:{},elems:[],interval:1e3,callback_id:0,cache:{},auto_start:!1,token:"",serverURL:"http://localhost:58725",log:function(){var e;return!OPC.debug||typeof console=="undefined"||console===null||console.log==null?!1:(e=Array.prototype.slice.call(arguments),e.splice(0,0,"OPC.log"),console.log(e),!0)},log_err:function(e,t){var n;return n=t.stack!=null?t.stack:"",e=e==null?"<<ERROR>>":"<< "+e+" >>",OPC.log(""+e+"\n===\n"+t.message+"\n===\n"+n),!0},init:function(e){var t,n,r,i,s,o,u,a,f;this.config=e,this.toggle_refresh(!1),this.config==null&&(this.config=window.OPC_config),this.config==null&&(this.config={}),OPC.tags={},this.interval=this.config.interval!=null?this.config.interval:this.interval,this.debug=this.config.debug!=null?this.config.debug:this.debug,this.debug_refresh=this.config.debug_refresh!=null?this.config.debug_refresh:this.debug_refresh,this.auto_start=this.config.auto_start!=null?this.config.auto_start:this.auto_start,this.token=this.config.token!=null?this.config.token:this.token,this.serverURL=this.config.serverURL!=null?this.config.serverURL:this.serverURL,this.locale=this.config.locale!=null?this.config.locale:"us",this.trend_bindings=this.config.trend_bindings!=null?this.config.trend_bindings:[],this.alarm_bindings=this.config.alarm_bindings!=null?this.config.alarm_bindings:[],this.refresh_callback=this.config.refresh_callback,this.tag_prefix=this.config.tag_prefix!=null?this.config.tag_prefix:"",this.max_tags_per_msg=this.config.max_tags_per_msg!=null?this.config.max_tags_per_msg:0,this.reload_interval=this.config.reload_interval!=null?this.config.reload_interval:0,this.root_elem=this.config.root_elem!=null?$(this.config.root_elem):$("body");if(this.config.watch_tags!=null&&this.config.watch_tags.length>0){this.config.tags==null&&(this.config.tags=[]),a=this.config.watch_tags;for(i=0,o=a.length;i<o;i++)r=a[i],n=OPC.parse_tag_prop(r),this.config.tags.push({name:n[0],props:[{name:n[1]}]})}if(this.config.tags!=null&&this.config.tags.length>0){if(this.tag_prefix!=null){f=this.config.tags;for(s=0,u=f.length;s<u;s++)t=f[s],t.name=t.ignore_prefix?t.name:""+this.tag_prefix+t.name}this.add_tags(this.config.tags),this.log("initilization, config.tags: "+this.config.tags.length)}return document.location!=null&&document.location.protocol==="ms-appx:"&&(this.app_url=document.location.protocol+"//"+document.location.host,this.iframe_id=this.config.iframe_id!=null?this.config.iframe_id:"opc_rt_iframe",$(document).ready(function(){var e,t,n,r;return n=$("#"+OPC.iframe_id),n.length===0?$("body").append($("<iframe id='"+OPC.iframe_id+"' style='position:absolute;top:-1000px;left:-1000px;width:0;height:0;background-color:transparent;'></iframe>")):($(n).css("position","absolute").css("top","-1000px").css("left","-1000px"),$(n).width(0).height(0).css("background-color","transparent")),$("#"+OPC.iframe_id).load(function(){var e,t;return e=document.getElementById(""+OPC.iframe_id),t={type:"init",parent_url:OPC.app_url},e.contentWindow.postMessage(JSON.stringify(t),"*"),!0}),$(n).attr("src","ms-appx-web:///"+OPC.iframe_id+".html"),t=window.addEventListener!=null?"addEventListener":"attachEvent",e=window[t],r=t==="attachEvent"?"onmessage":"message",e(r,function(e){var t;if(e.data){t=JSON.parse(e.data);if(t.tags)return OPC.refresh_data(t,t.cid)}},!1),!0})),OPC.Alarm.init_alarms(),this.scan_document(),this},restart_refresh:function(){return(this.auto_start||this.token!=null&&this.token!=="")&&this.toggle_refresh(!0),!0},scan_document:function(){var e,t,n,r,i,s,o,u,a,f=this;this.toggle_refresh(!1),s=[],r=[],i=[],o=!1,n="";for(e in OPC.Elem.val_ops)t="opc-tag-"+e,$("["+t+"]",OPC.root_elem).each(function(u,a){var f,l,c,h,p,d,v,m,g;try{n="#"+$(a).attr("id"),p=$.parseJSON($(a).attr(t));if(p.tag!=null){h=OPC.parse_tag_prop(p.tag);if(h.length===2)return f=p.ignore_prefix?h[0]:""+OPC.tag_prefix+h[0],l={name:f,props:[{name:h[1],elems:[{sel:""+n,acts:[{type:e,config:p.config}]}]}],ignore_prefix:p.ignore_prefix},e==="set"?(i.push(l),c=$.extend(!0,{},l),c.props=[{name:[h[1]]}],s.push(c)):s.push(l),o=!0}else if(p.type!=null&&
(p.type==="comp"||p.type==="group")){l={type:e,sel:""+n,vals:[],ignore_prefix:p.ignore_prefix};if(p.type==="group"&&p.group!=null&&p.group.length>0){l.bad_q=p.bad_q,l.all_f=p.all_f,g=p.group;for(v=0,m=g.length;v<m;v++)d=g[v],d.tag!=null&&(h=OPC.parse_tag_prop(d.tag),h.length===2&&(f=p.ignore_prefix?h[0]:""+OPC.tag_prefix+h[0],l.vals.push({tag:f,prop:h[1],config:d.config})))}else p.type==="comp"&&p.tag1!=null&&p.tag2!=null&&p.op!=null&&l.vals.push({tag1:p.tag1,tag2:p.tag2,op:p.op,config:p.config});if(l.vals.length>0)return r.push(l),o=!0}}catch(y){return OPC.log_err("Error parsing tag ["+e+"] on ["+n+"]",y)}});this.add_tags(s),this.add_elems(r),this.bind_sets(i),a=0;for(u in OPC.tags)a++;return OPC.log("scanning done. total tags: "+a),this.restart_refresh(),!0},stop_interval:function(e){return OPC.intervals!=null&&OPC.intervals[e]!=null&&(OPC.intervals[e]=null),!0},clear_interval:function(e){return OPC.active_interval[e]!=null&&(clearTimeout(OPC.active_interval[e]),OPC.active_interval[e]=null),!0},run_interval:function(e,t,n){var r;return OPC.intervals==null&&(OPC.intervals={}),OPC.active_interval==null&&(OPC.active_interval={}),OPC.intervals[n]=1,r=function(t,n){return function(){if(OPC.intervals!=null&&OPC.intervals[n]!=null){OPC.clear_interval(n),OPC.active_interval[n]=setTimeout(r,t);try{e.call(null)}catch(i){}}return!0}}(t,n),r(t,n)},is_refreshing:function(){return OPC.intervals!=null&&OPC.intervals.timer},toggle_refresh:function(e){if(!e)return OPC.stop_interval("timer"),!1;e=OPC.interval!=null&&OPC.interval>0&&(e!=null?e:!OPC.is_refreshing);if(!e&&!OPC.is_refreshing)return;return e?(OPC.refresh(),OPC.run_interval(OPC.refresh,OPC.interval,"timer"),OPC.reload_interval!=null&&OPC.reload_interval>0&&setTimeout(function(){return document.location.reload()},OPC.reload_interval*6e4)):OPC.stop_interval("timer"),!0},parse_tag_prop:function(e,t){var n,r,i,s,o,u,a;e=t!=null?""+e+"."+t:e,s=$.trim(e).split(".");for(n=u=0,a=s.length;u<a;n=++u)r=s[n],s[n]=$.trim(r);return s.length>2&&(i=s.slice(0),o=i.splice(s.length-1,1),s=[i.join("."),o[0]]),s},get_tag_json:function(e,t,n){var r,i,s,o,u,a;a=OPC.parse_tag_prop(e,t),n===void 0&&a.length===2&&(e=a[0],t=a[1]),u={tags:[]};for(o in OPC.tags)if(e==null||o===e){i={name:o,props:[]};for(s in OPC.tags[o].props)if(t==null||s===t)r={name:s,val:n},i.props.push(r);u.tags.push(i)}return u},refresh_data:function(e,t){return OPC.debug_refresh&&OPC.log(e),OPC.read_tags(e.tags,t),OPC.set_elems(),OPC.refresh_callback&&OPC.refresh_callback(e,t),!0},refresh:function(){var e,t,n,r,i,s,o,u,a,f,l,c;OPC.Trend.refresh_data(),OPC.Alarm.refresh_data(),t=OPC.get_tag_json(),s=[],i=[],c=t.tags;for(n=u=0,f=c.length;u<f;n=++u){r=c[n];if(i.length<OPC.max_tags_per_msg||OPC.max_tags_per_msg===0)i.push(r),i.length===OPC.max_tags_per_msg&&n!==t.tags.length-1&&(s.push(i),i=[])}i.length>0&&s.push(i);for(a=0,l=s.length;a<l;a++)o=s[a],t.tags=o,t.status="OK",t.message="",e=OPC.callback_id++,OPC.get({url:"/getdata",data:t,cid:e,success:function(e){return function(t,n){return OPC.refresh_data(t,e),OPC.clean_callback(e),OPC.refresh_callback!=null&&OPC.refresh_callback(t),!0}}(e),error:function(e){return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)}});return t=null,!0},get_trend_binding:function(e){return OPC.Trend.get_binding(e)},get_history_data:function(e,t,n){return OPC.Trend.get_history_data(e,t,n)},resume_trend_data:function(e){return OPC.Trend.resume_trend_data(e)},set_val:function(e,t,n){return OPC.set_value(e,t,n)},set_value:function(e,t,n){var r,i,s;return s=n!=null?OPC.parse_tag_prop(e,t):OPC.parse_tag_prop(e),n===void 0&&s.length===2&&(n=t,e=s[0],t=s[1]),i=OPC.get_tag_json(e,t,n),i.status="OK",i.message="",r=OPC.callback_id++,OPC.get({url:"/setdata",data:i,cid:r,success:function(e){return function(t,n){return OPC.debug_refresh&&OPC.log(t),OPC.clean_callback(e),!0}}(r),error:function(e){return OPC.log("SET VALUE ERROR: "+e.status+", "+e.statusText)}}),!0},authenticate:function(e,t){var n;return OPC.toggle_refresh(!1),n=OPC.callback_id++,OPC.get({url:"/gettoken",data:{un:e!=null?e:"",pw:t!=null?t:""},cid:n,success:function(e){return function(t,n){return OPC.token=t.message,OPC.debug_refresh&&OPC.log(t),OPC.token!=null&&OPC.token!==""&&OPC.toggle_refresh(!0),OPC.clean_callback(e),!0}}(n),error:function(e){return OPC.log("GET TOKEN ERROR: "+e.status+", "+e.statusText),OPC.token="AUTH FAILURE"}}),!0},clean_callback:function(e){window["opcwebcb_"+e]=null;try{delete window["opcwebcb_"+e]}catch(t){}return!0},get:function(e){var t,n,r,i;return t="application/json; charset=utf-8",e.data.token=OPC.token,i=typeof e.data=="string"?e.data:JSON.stringify(e.data),n={message:i},OPC.app_url&&OPC.app_url!==""?(i={type:"json",data:n,url:OPC.serverURL+"/OPCREST"+e.url,cid:OPC.callback_id++},r=document.getElementById(""+OPC.iframe_id),r!=null&&r.contentWindow.postMessage(JSON.stringify(i),"*"),i=null):$.ajax({url:""+OPC.serverURL+"/OPCREST"+e.url,dataType:e.dataType!=null?e.dataType:"jsonp",contentType:e.contentType!=null?e.contentType:t,data:n,jsonpCallback:"opcwebcb_"+e.cid,success:e.success,error:e.error}),!0},read_tags:function(e,t){var n,r,i,s,o,u,a;for(i=0,o=e.length;i<o;i++){r=e[i],a=r.props;for(s=0,u=a.length;s<u;s++)n=a[s],OPC.debug_refresh&&OPC.log("cid:"+t+" "+r.name+"."+n.name+": "+n.val+" datatype:"+n.datatype),OPC.read_tag(r.name,n.name,n.val,n.qual,n.datatype,t),!0;!0}return!0},read_tag:function(e,t,n,r,i,s){var o;o=this.tags[e];if(o!=null)return o.read_prop(t,n,r,i,s)},set_elems:function(){var e,t;for(e in OPC.elems)t=OPC.elems[e],t.set_groups(),t.set_comps();return!0},add_tags:function(e){var t,n,r,i,s;if(e==null||e.length===0)return!1;for(i=0,s=e.length;i<s;i++){n=e[i];if(n.name==null||n.props==null)continue;t=n.name,r=this.tags[t],r!=null?r.add_props(n.props):this.tags[t]=new OPC.Tag({name:t,props:n.props})}return!0},get_tag_config:function(e,t){var n,r;return n={name:"",props:[{name:"",elems:[]}]},r=OPC.parse_tag_prop(e,t),r.length===2?(n.name=r[0],n.props[0].name=r[1]):e!=null&&
t!=null&&(n.name=e,n.props[0].name=t),n},ubind_sets:function(e){var t,n,r,i,s,o,u,a,f;f=[];for(u=0,a=e.length;u<a;u++)o=e[u],s=o.name,f.push(function(){var e,s,u,a;u=o.props,a=[];for(e=0,s=u.length;e<s;e++)r=u[e],n=r.name,a.push(function(){var e,n,s,o;s=r.elems,o=[];for(e=0,n=s.length;e<n;e++){t=s[e],i=t.sel;if(i==null||$(i,OPC.root_elem).length===0)continue;o.push($(i,OPC.root_elem).unbind(".OPCEvents"))}return o}());return a}());return f},bind_sets:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;if(e==null||e.length===0)return!1;OPC.ubind_sets(e);for(a=0,h=e.length;a<h;a++){u=e[a],o=u.name,m=u.props;for(f=0,p=m.length;f<p;f++){i=m[f],r=i.name,g=i.elems;for(l=0,d=g.length;l<d;l++){n=g[l],s=n.sel;if(s==null||$(s,OPC.root_elem).length===0)continue;y=n.acts;for(c=0,v=y.length;c<v;c++){t=y[c];if(t.config!=null&&t.config.evt!=null&&t.config.set!=null)switch(t.config.evt){case"click":(function(e,t,n){var r;return r=function(){return OPC.Elem.val_ops.set(e,t,n,$(this)),!0},$(s,OPC.root_elem).bind("click.OPCEvents",r)})(o,r,t.config);break;case"change":(function(e,t,n){var r,i=this;return r=function(){return OPC.Elem.val_ops.set(e,t,n,$(i)),!0},$(s,OPC.root_elem).bind("change.OPCEvents",ch)})(o,r,t.config)}}}}}return!0},add_elems:function(e){var t,n,r,i,s,o,u,a,f,l;if(e==null||e.length===0)return!1;i=[];for(o=0,a=e.length;o<a;o++){r=e[o],n=this.elems[r.sel],t={sel:r.sel,bad_q:r.bad_q,all_f:r.all_f};if(r.vals!=null&&r.vals.length>0){t.vals={},t.vals[r.type]=r.vals,l=r.vals;for(u=0,f=l.length;u<f;u++)s=l[u],s.tag1!=null?(i.push(this.get_tag_config(s.tag1)),i.push(this.get_tag_config(s.tag2))):i.push(this.get_tag_config(s.tag,s.prop));n!=null?n.add_groups(t):this.elems[r.sel]=new OPC.Elem(t)}i.length>0&&this.add_tags(i)}return!0},set_cache:function(e,t,n){var r;return r=OPC.cache[e],r==null&&(r={},OPC.cache[e]=r),r[t]=n,n},get_cache:function(e,t){var n;return n=OPC.cache[e],n==null&&(n={},OPC.cache[e]=n),n[t]},get_value:function(e,t){var n,r,i;return e==null?null:(i=OPC.parse_tag_prop(e,t),i.length===2&&(e=i[0],t=i[1]),r=OPC.tags[$.trim(e)],n=r!=null?r.props[$.trim(t)]:null,n!=null?n.val:null)},set_styles:function(e,t,n){var r,i,s,o,u,a,f;o=n.split(";");for(a=0,f=o.length;a<f;a++){s=o[a],s=$.trim(s);if(s==="")continue;i=s.split(":"),r=i[0],i.length>2?u=i.slice(1).join(":"):u=i[1],OPC.set_style(e,r,t,u)}return OPC.build_style(e),!0},set_style:function(e,t,n,r,i){var s,o,u,a,f,l;o=OPC.get_styles(e,t),l=o.vals;for(u=a=0,f=l.length;a<f;u=++a){s=l[u];if(s.src===n){o.vals.splice(u,1);break}}return o.vals.push({src:n,val:r}),i&&OPC.build_style(e),!0},get_styles:function(e,t,n){var r,i;return r=OPC.get_cache(e,t),r==null&&(i=n!=null?n:$("#"+e,OPC.root_elem).css(t),r={original:i,vals:[]},OPC.set_cache(e,t,r)),r},remove_styles:function(e,t){var n,r,i,s,o,u,a,f;n=OPC.cache[e];if(n==null)return!1;for(s in n){r=n[s];if(r.vals!=null&&r.vals.length>0){i=[],f=r.vals;for(u=0,a=f.length;u<a;u++)o=f[u],o.src!==t&&i.push(o);r.vals=i}}return OPC.build_style(e),!0},build_style:function(e){var t,n,r,i,s;n=$("#"+e,OPC.root_elem),r=OPC.cache[e];if(r!=null)for(i in r)t=r[i],s=t.original,t.vals!=null&&t.vals.length>0&&(s=t.vals[t.vals.length-1].val),n.css(i,s);return!0}},OPC.Util=function(){function e(){}return e.padleft=function(e,t,n){var r;return r=(new Array(n+1)).join(t)+e,r.length>n&&(r=r.slice(r.length-n)),r},e.formatDate=function(e,t){var n,r,i,s,o,u,a,f,l,c;return c=e.getFullYear(),a=OPC.Util.padleft(e.getMonth()+1,"0",2),i=OPC.Util.padleft(e.getDate(),"0",2),r=a+"/"+i+"/"+c,o=e.getHours(),u=OPC.Util.padleft(e.getMinutes(),"0",2),f=OPC.Util.padleft(e.getSeconds(),"0",2),n=o>=12?"pm":"am",s=o,s>12?s-=12:s===0&&(s=12),s=OPC.Util.padleft(s,"0",2),l=""+s+":"+u+":"+f+" "+n,t=t.replace("yyyy",""+c),t=t.replace("yy",(""+c).slice(2)),t=t.replace("mm",a),t=t.replace("dd",i),t=t.replace("HH",o),t=t.replace("hh",s),t=t.replace("MM",u),t=t.replace("ss",f),t=t.replace("aa",""+n),t},e}(),OPC.Tag=function(){function e(e){this.name=e.name,this.props={},e.props!=null&&e.props.length>0&&this.add_props(e.props),this}return e.prototype.add_props=function(e){var t,n,r,i;for(r=0,i=e.length;r<i;r++){t=e[r];if(t.name==null)continue;n=this.props[t.name],n!=null?n.add_elems(t.elems):this.props[t.name]=new OPC.Prop({name:t.name,elems:t.elems,tag:this})}return!0},e.prototype.read_prop=function(e,t,n,r,i){var s;return s=this.props[e],s!=null?s.read_val(t,n,r,i):!1},e}(),OPC.Prop=function(){function e(e){this.name=e.name,this.elems={},this.val="",this.cid=-1,this.quality=!0,this.data_type="",this.tag=e.tag!=null?e.tag:null,e.elems!=null&&e.elems.length>0&&this.add_elems(e.elems),this}return e.prototype.add_elems=function(e){var t,n,r,i;if(e==null)return;for(r=0,i=e.length;r<i;r++){n=e[r],n.ref!=null&&(n.sel="#"+$(n.ref).attr("id"));if(n.sel==null||n.sel==="#"||n.acts==null)continue;t=this.elems[n.sel],t!=null?t.add_acts(n.acts):(t=new OPC.Elem({sel:n.sel,acts:n.acts}),this.elems[n.sel]=t)}return!0},e.prototype.read_val=function(e,t,n,r){var i,s;s=e==null?null:e.toString();if(s===this.val)return!1;this.val=s,this.quality=t,this.data_type=n,this.cid=r;for(i in this.elems)this.elems[i].read_val(e,n);return!0},e}(),OPC.Elem=function(){function t(e){this.ignore_prefix=e.ignore_prefix,this.sel=e.sel,this.add_acts(e.acts),this.add_groups(e),this}var e=this;return t.prototype.add_acts=function(e){var t,n,r;if(e==null||e.length===0)return!1;this.acts==null&&(this.acts=[]);for(n=0,r=e.length;n<r;n++)t=e[n],t!=null&&t.type!=null&&this.acts.push(t);return!0},t.prototype.add_groups=function(e){var t,n;if(e==null||e.vals==null||e.vals.length<1)return!1;this.groups==null&&(this.groups={});for(n in e.vals)t={bad_q:e.bad_q,all_f:e.all_f,vals:e.vals[n]},this.groups[n]=t;return!0},t.prototype.add_comps=function(e){var t;if(e==null)return!1;this.comps==null&&(this.comps={});for(t in e)this.comps[t]=e[t];return!0},t.prototype.read_val=function(e,t){var n,r,i,s,o,u,a,f,l;r=$(this.sel,OPC.root_elem);if(r.length>0){l=this.acts;for(o=0,a=l.length;o<a;o++){n=l[o],i=OPC
.Elem.val_ops[n.type];if(i!=null)for(u=0,f=r.length;u<f;u++)s=r[u],i(n,s,e,t)}return!0}return!1},t.prototype.set_groups=function(){var e,t,n,r,i,s,o,u,a,f,l,c;if(this.sel==null||$(this.sel,OPC.root_elem).length===0)return!1;n=$(this.sel,OPC.root_elem);for(r in this.groups){i=this.groups[r],t=null,u=!1,s=!0,c=i.vals;for(f=0,l=c.length;f<l;f++){o=c[f],a=OPC.get_value(o.tag,o.prop),e=OPC.Elem.parseBool(a);if(i.bad_q!=null&&!u&&a==null){s=!1;break}if(o.tag!=null&&e||o.tag1!=null&&o.tag2!=null&&o.op!=null&&this.test_comp(o.tag1,o.tag2,o.op))t=t!=null?t:o.config,u=u||!0;OPC.Elem.val_ops[r]({config:o.config},this.sel,!1)}s?i.all_f!=null&&!u&&(t=i.all_f,u=!0):(t=i.bad_q,u=!0),OPC.Elem.val_ops[r]({config:t},this.sel,u)}return!0},t.prototype.test_comp=function(e,t,n){var r,i;return r=OPC.get_value(e),i=OPC.get_value(t),n==="="&&r===i||n===">"&&r>i||n===">="&&r>=i||n==="<"&&r<i||n==="<="&&r<=i||n==="!="&&r!==i?!0:!1},t.prototype.set_comps=function(){var e,t,n,r;if(this.sel==null||$(this.sel,OPC.root_elem).length===0)return!1;r=$(this.sel,OPC.root_elem);for(t in this.comps)n=this.comps[t],e=this.test_comp(n.tag1,n.tag2,n.op);return!0},t.val_ops={src:function(e,n,r){return t.set_attr($(n).attr("id"),"orig-src","src",e.config,r),!0},"bkg-img":function(e,n,r){return t.set_styles(n,"img",e.config,r,"background-image"),!0},bkg:function(e,n,r){return t.set_styles(n,"bkg",e.config,r,"background-color"),!0},"bkg-fl":function(e,n,r){return t.flash(n,e,r,"background-color"),!0},fg:function(e,n,r){return t.set_styles(n,"fg",e.config,r,"color"),!0},"fg-fl":function(e,n,r){return t.flash(n,e,r,"color"),!0},brd:function(e,n,r){return t.set_styles(n,"brd",e.config,r,"border-color"),!0},"brd-fl":function(e,n,r){return t.flash(n,e,r,"border-color"),!0},val:function(e,n,r,i){return $(n).val(t.format_data(r,i,e.config)),!0},txt:function(e,n,r,i){return $(n).empty(),$(n).html(t.format_data(r,i,e.config)),!0},tt:function(e,n,r,i){return $(n).attr("title",t.format_data(r,i,e.config)),!0},en:function(e,n,r,i){var s;return s=!0,r==null&&e!=null&&e.config!=null&&e.config.bad_q!=null?s=t.parseBool(e.config.bad_q):r!=null&&(s=t.parseBool(r),e.config!=null&&e.config.trigger!=null&&e.config.trigger==="on_false"&&(s=!s)),s?$(n).removeAttr("disabled"):$(n).attr("disabled","disabled"),!0},vis:function(e,n,r){var i,s;return s=!0,i=e.config!=null&&e.config.rate!=null?parseFloat(e.config.rate):100,r==null&&e!=null&&e.config!=null&&e.config.bad_q!=null?s=t.parseBool(e.config.bad_q):r!=null&&(s=t.parseBool(r),e.config!=null&&e.config.trigger!=null&&e.config.trigger==="on_false"&&(s=!s)),s?($(n).css("display",""),$(n).animate({opacity:1},{duration:i,queue:!1})):$(n).animate({opacity:0},{duration:i,queue:!1},null,function(){return $(this).css("display","none")}),!0},op:function(e,n,r){var i;return i=t.resolve_value(e.config,r),i!=null&&$(n).animate({opacity:i.val},{duration:i.rate,queue:!1}),!0},wd:function(e,n,r){var i;return i=t.resolve_value(e.config,r),i!=null&&$(n).animate({width:i.val},{duration:i.rate,queue:!1}),!0},ht:function(e,n,r){var i;return i=t.resolve_value(e.config,r),i!=null&&$(n).animate({height:i.val},{duration:i.rate,queue:!1}),!0},sx:function(e,n,r){var i,s;return s=t.resolve_value(e.config,r),i=OPC.get_styles($(n).attr("id"),"outerWidth",$(n).outerWidth()),s!=null&&$(n).animate({width:s.val*i.original+s.offset},{duration:s.rate,queue:!1}),!0},sy:function(e,n,r){var i,s;return s=t.resolve_value(e.config,r),i=OPC.get_styles($(n).attr("id"),"outerHeight",$(n).outerHeight()),s!=null&&$(n).animate({height:s.val*i.original+s.offset},{duration:s.rate,queue:!1}),!0},tx:function(e,n,r){var i;return i=t.resolve_value(e.config,r),i!=null&&($(n).css("position","absolute"),$(n).animate({left:i.val},{duration:i.rate,queue:!1})),!0},ty:function(e,n,r){var i;return i=t.resolve_value(e.config,r),i!=null&&($(n).css("position","absolute"),$(n).animate({top:i.val},{duration:i.rate,queue:!1})),!0},set:function(e,n,r,i){var s,o,u,a,f,l,c,h,p;p=null,s="CANCEL",l="OK",r.set_confirm_buttons!=null&&r.set_confirm_buttons==="yesno"&&(s="NO",l="YES"),f=r.set_confirm_msg!=null?r.set_confirm_msg:"Save new value for "+e+"."+n+"?",h=r.set_confirm_title!=null?r.set_confirm_title:"Confirm Submission",o=t.parseBool(r.set_confirm),c=!1;switch(r.set){case"value":p=null,r.set_value!=null?p=r.set_value:r.set_src!=null?p=$("#"+r.set_src,OPC.root_elem).val():p=$(i).val();break;case"input":o=!0,c=!0,h=r.set_confirm_title!=null?h:"Enter a Value",p=null;break;case"toggle":p="toggle"}return o?(u={tag:e,prop:n,title:h,message:f,show_input:c,val:p,buttons:[{text:s},{text:l,click:OPC.set_val}]},a=new OPC.Modal(u)):p!=null&&OPC.set_val(e,n,p),!0},fn:function(e,n,r){return r!=null&&t.parseBool(r)&&e.config!=null&&e.config.fn!=null&&t.execute_fn(e.config.fn),!0},style:function(e,n,r){var i;return i=e!=null&&e.config!=null&&e.config.style!=null?e.config.style:null,r!=null&&t.set_attr($(n).attr("id"),"orig-style","style",i,r),!0},cls:function(e,n,r){var i;return i=e!=null&&e.config!=null&&e.config.cls!=null?e.config.cls:null,r!=null&&t.set_attr($(n).attr("id"),"orig-cls","class",i,r),!0}},t.resolve_value=function(e,t){var n,r,i,s;return s=e!=null&&e.rate!=null?parseFloat(e.rate):OPC.interval/5,r=e!=null&&e.gain!=null?parseFloat(e.gain):1,n=e!=null&&e.formats!=null&&e.formats.bad_q!=null?parseFloat(e.formats.bad_q):-1,i=e!=null&&e.offset!=null?parseFloat(e.offset):0,t!=null?t=parseFloat(t)*r+i:t=n!==-1?n:t,{val:t,rate:s,gain:r,offset:i,bad_q:n}},t.format_data=function(e,t,n){var r,i,s,o;if(n==null||n.formats==null)return e;if(e==null&&n.formats.bad_q!=null)return n.formats.bad_q;s=n.formats["locale"]!=null?n.formats.locale:OPC.locale;switch(t){case"int":n.formats["int"]!=null&&(o=parseInt(e),e=$.formatNumber(o,{format:n.formats["int"],locale:s}));break;case"float":n.formats["float"]!=null&&(o=parseFloat(e),e=$.formatNumber(o,{format:n.formats["float"],locale:s}));break;case"boolean":r=this.parseBool(e),r&&n.formats.bool_t!=null?e=n.formats.bool_t:!r&&n.formats.bool_f!=null&&
(e=n.formats.bool_f);break;case"datetime":n.formats["date"]!=null&&(i=new Date(e),e=i.toString(n.formats.date));break;case"string":if(n.formats.string!=null)return n.formats.string.replace("{0}",e);return e}return n.formats.string!=null&&(e=n.formats.string.replace("{0}",e)),e},t.flash=function(e,t,n,r){var i,s,o,u,a,f,l=this;i=t.type,o=t.config.rate!=null?t.config.rate:200,a=t.config.trigger!=null?t.config.trigger:"on_true",f=this.parseBool(n);if(a!=="trans"&&(!f&&(a==="on_true"||a==="trans_true")||f&&(a==="on_false"||a==="trans_false"))){$(e).attr(i)!=null&&($(e).attr(i,-99),OPC.remove_styles($(e).attr("id"),t.type),$(e).dequeue(i));return}return $(e).attr(i)==null&&$(e).attr(i,0),s=parseInt($(e).attr(i)),$(e).attr(i)!=null&&(s=parseInt($(e).attr(i))+1,$(e).attr(i,s)),a!=="on_true"&&a!=="on_false"&&t.config.repeat!=null&&(u=parseInt(t.config.repeat),u>0&&s>=u*2&&(s=-99)),s<0?($(e).removeAttr(i),OPC.remove_styles($(e).attr("id"),t.type),!1):(s%2!==0?this.set_styles(e,t.type,t.config,!0,r):OPC.remove_styles($(e).attr("id"),t.type),$(e).delay(o,i).queue(i,function(){return l.flash(e,t,n,r)}).dequeue(i))},t.execute_fn=function(e,t){var n,r,i,s,o,u,a;t=Array.prototype.slice.call(arguments).splice(1),n=window,s=e.split("."),r=s.pop();for(i=u=0,a=s.length;u<a;i=++u)o=s[i],n=n[o];return n[r].apply(window,t)},t.set_styles=function(e,t,n,r,i){var s;if(r==null||n==null)return!1;s=$(e).attr("id"),OPC.remove_styles(s,t),n.cls!=null&&$(e).toggleClass(n.cls,!1),n.color!=null&&i!=null&&r&&OPC.set_style(s,i,t,n.color,!0),n.style!=null&&r&&OPC.set_styles(s,t,n.style);if(n.cls!=null)return $(e).toggleClass(n.cls,r)},t.set_attr=function(e,t,n,r,i){var s,o,u,a;return u=OPC.get_cache(e,t),o=$("#"+e,OPC.root_elem),a=this.parseBool(i),u==null&&(s=o.attr(n),s=s!=null?s:"",u=OPC.set_cache(e,t,s)),a?o.attr(n,r):u!=null?o.attr(n,u):o.attr(n,""),!0},t.parseBool=function(e){var t;return t=!1,e!=null&&(t=$.trim(e.toString().toLowerCase())==="true"||!isNaN(e)&&parseFloat(e)>0),t},t}.call(this),OPC.Modal=function(){function e(t){var n,r,i,s,o,u,a,f,l,c,h,p=this;this.config=t,this.close=function(){return e.prototype.close.apply(p,arguments)};if($("#opc-modal-overlay").length>0)return!1;this.overlay=$('<div id="opc-modal-overlay"></div>'),$("body").append(this.overlay),this.config.id==null&&(this.config.id="opc-modal"),i=this.config.cls!=null?this.config.cls:"",a="<input type='text' id='opc-modal-val' value='"+OPC.get_value(this.config.tag,this.config.prop)+"'/>",a=this.config.contents!=null?this.config.contents:a,f=this.config.message!=null?"<div class='opc-modal-message'>"+this.config.message+"</div>":"",o="    <div class='opc-modal-dialog "+i+"' id='"+this.config.id+"' style='display:none;'>    	<div class='opc-modal-title' >"+this.config.title+"</div>    	"+f+"    	<div class='opc-modal-message' id='opc-modal-input' style='display:none;'>"+a+"</div>    	<div class='opc-modal-buttons'></div>    </div>",this.dialog=$(o),$("body").append(this.dialog),this.config.show_input&&$("#opc-modal-input").show(),this.config.val!=null&&$("#opc-modal-val").val(this.config.val),this.config.buttons==null&&(this.config.buttons=[],this.config.buttons.push({text:"OK"})),h=this.config.buttons;for(u=l=0,c=h.length;l<c;u=++l)n=h[u],s=this.dialog.find(".opc-modal-buttons"),s.append($("<button id='button_"+u+"'>"+n.text+"</button>")),r=s.find("#button_"+u),n.defer_close?r.click(n.click):r.click(function(e){var t,n,r,i,s,o;n=e.target.id,o=p.config.buttons;for(r=i=0,s=o.length;i<s;r=++i){t=o[r];if(t.click!=null&&"button_"+r===n){if(p.config.tag==null){t.click(p);break}t.click(p.config.tag,p.config.prop,$("#opc-modal-val").val())}}return p.close()});$(window).resize(function(){return p.dialog.center()}),this.dialog.center(),this.overlay.fadeTo(200,.5),this.dialog.fadeTo(200,1),this}return e.prototype.close=function(){return this.dialog.fadeTo(100,0,function(){return $(this).remove()}),this.overlay.fadeTo(100,0,function(){return $(this).remove()}),!0},e}(),OPC.TrendRequest=function(){function e(e,t,n){var r,i,s,o,u;this.token=OPC.token,this.requesttype=e.requesttype,this.chartinstanceguid=e.guid,this.samplerate=e.samplerate,this.timeframe=e.timeframe,this.tagnames=t!=null?t:[],this.historytagnames=n!=null?n:[],this.starthistorydate=e.starthistorydate,this.endhistorydate=e.endhistorydate,this.returnalldatawithtimes=e.returnalldatawithtimes!=null?e.returnalldatawithtimes:!1,this.historystatprocessing=[],u=e.tags;for(s=0,o=u.length;s<o;s++)i=u[s],typeof i=="string"?this.historystatprocessing.push("avg"):typeof i=="object"&&i.tag!=null&&(r=i.historystatprocessing!=null?i.historystatprocessing:"avg",this.historystatprocessing.push(r))}return e}(),OPC.Trend=function(){function e(){}return e.getTrendBinding=function(e){var t,n,r,i;i=OPC.trend_bindings;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.guid===e.chartinstanceguid)return t}return null},e.getHistoryData=function(e,t,n){return OPC.get_history_data(e,t,n)},e.resumeTrendData=function(e){return OPC.resume_trend_data(e)},e.get_binding=function(e){var t,n,r,i;if(typeof e!="string")return e;i=OPC.trend_bindings;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.chartid!=null&&t.chartid===e)return t}return null},e.get_history_data=function(e,t,n){return t=typeof t=="string"?new Date(t):t,n=typeof n=="string"?new Date(n):n,e=OPC.Trend.get_binding(e),e==null?!1:(e.mode="history",e.starthistorydate=t.getTime(),e.endhistorydate=n.getTime(),e.requesttype="HistoryRequest",e.trend_data=e.trend_data!=null?e.trend_data:e.data,e.trend_retain=e.trend_retain!=null?e.trend_retain:e.retain,e.retain=null,e.data=null,!0)},e.resume_trend_data=function(e){return e=OPC.Trend.get_binding(e),e==null||e.mode!=="history"?!1:(e.mode="trend",e.guid=null,e.data=e.trend_data,e.retain=e.trend_retain,e.requesttype="RefreshData",delete e.starthistorydate,delete e.endhistorydate,delete e.trend_data,delete e.trend_retain,!0)},e.refresh_data=function(){var e,t,n,r;if(OPC.trend_bindings==null)return!1;r=OPC.trend_bindings;for(t=0,n=r.length;t<n;t++)e=r
[t],e.requesttype==null&&(e.requesttype=""),e.guid!=null?e.requesttype!=="HistoryRequest"&&e.requesttype!=="HistoryData"&&(e.requesttype="NewData"):e.guid="",e.mode==null&&(e.mode="trend"),OPC.Trend.get_data(e);return!0},e.get_data=function(e){var t,n,r,i,s,o,u;n=[],t=[],u=e.tags;for(s=0,o=u.length;s<o;s++)i=u[s],typeof i=="string"?(n.push(i),t.push("")):typeof i=="object"&&i.tag!=null&&(n.push(i.tag),i.historytag!=null?t.push(i.historytag):t.push(""));if(n.length===0)return;return r=new OPC.TrendRequest(e,n,t),e.cid=OPC.callback_id++,OPC.get({url:"/gettrenddata",data:r,cid:e.cid,success:function(e){return function(t,n){var r,i,s,o;o=OPC.trend_bindings;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.cid===e){r.guid=t.chartinstanceguid,r.requesttype==="HistoryRequest"||r.requesttype==="HistoryData"?r.requesttype="HistoryData":r.requesttype="NewData",t.penvalues!=null&&t.firsttime>0&&r.callback!=null&&(t.firsttime=new Date(t.firsttime),t.lasttime=new Date(t.lasttime),r.callback(t));break}}return OPC.clean_callback(e),!0}}(e.cid),error:function(e){return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)}}),!0},e}(),OPC.Flot=function(){function e(){}return e.buildTrendData=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;r=OPC.Trend.getTrendBinding(e);if(r===null)return null;l=e.matchingindex,m=e.lasttime.getTime()-e.firsttime.getTime(),f=0,e.numberofvalues>1&&(f=m/(e.numberofvalues-1)),u=[],t=e.timesforreturnalldata,S=e.penvalues;for(h=y=0,w=S.length;y<w;h=++y){c=S[h],p=r.tags[h],r.data==null&&(r.data={}),v="",typeof p=="string"?v=p:typeof p=="object"&&p.tag!=null&&(v=p.tag),r.data[v]==null&&(r.data[v]=[]),i=r.data[v],o={data:r.data[v]},p.color!=null&&(o.color=p.color),p.label!=null&&(o.label=p.label),p.lines!=null&&(o.lines=p.lines),p.bars!=null&&(o.bars=p.bars),p.points!=null&&(o.points=p.points),p.xaxis!=null&&(o.xaxis=p.xaxis),p.yaxis!=null&&(o.yaxis=p.yaxis),p.clickable&&(o.clickable=!0),p.hoverable&&(o.hoverable=!0),p.shadowSize!=null&&(o.shadowSize=p.shadowSize),p.hilightColor&&(o.hilightColor=p.hilightColor),p.fill!=null&&(o.lines==null&&(o.lines={}),o.lines.fill=p.fill),n=t!=null?t[h]:null;for(a=b=0,E=c.length;b<E;a=++b)g=c[a],n!=null&&n[a]!==0?s=new Date(n[a]):(d=a*f+e.firsttime.getTime(),s=new Date(d)),i.push([s,g]);r.retain!=null&&i.length>r.retain&&(i=i.slice(i.length-r.retain)),o.data=i,u.push(o)}return u},e}(),OPC.Alarm=function(){function e(){}return e.getAlarmBinding=function(e){var t,n,r,i;i=OPC.alarm_bindings;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.guid===e.alarminstanceguid)return t}return null},e.refresh_data=function(){var e,t,n,r;if(OPC.alarm_bindings==null)return!1;r=OPC.alarm_bindings;for(t=0,n=r.length;t<n;t++)e=r[t],e.requesttype==null&&(e.requesttype="RefreshAllData"),e.guid==null&&(e.guid=""),e.mode==null&&(e.mode="alarms"),OPC.Alarm.get_data(e);return!0},e.send_update=function(e,t,n,r,i){var s;return s={token:OPC.token,alarmid:t,networknode:n,requesttype:r},r==="Comment"&&(s.comment=i),e.cid=OPC.callback_id++,OPC.get({url:"/updatealarm",data:s,cid:e.cid,success:function(e){return function(t,n){return OPC.clean_callback(e),!0}}(e.cid),error:function(e){return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)}}),!0},e.get_history=function(e,t,n){return t=new Date(t),n=new Date(n),e.requesttype="HistoryRequest",e.starthistorydate=t.getTime(),e.endhistorydate=n.getTime(),e.doclear=!0},e.get_realtime=function(e){return e.requesttype="RefreshAllData",delete e.starthistorydate,delete e.endhistorydate,e.doclear=!0},e.get_data=function(e){var t;return t={networknodes:e.networkNodes!=null?e.networkNodes:[],alarmfilter:e.filter?e.filter:[],token:OPC.token,requesttype:e.requesttype,starthistorydate:e.starthistorydate,endhistorydate:e.endhistorydate,alarminstanceguid:e.guid},e.cid=OPC.callback_id++,OPC.get({url:"/getalarmdata",data:t,cid:e.cid,success:function(t){return function(n,r){var i,s,o;o=OPC.alarm_bindings;for(i=0,s=o.length;i<s;i++){e=o[i];if(e.cid===t){e.guid=n.alarminstanceguid,e.doclear&&e.requesttype!=null&&e.requesttype!==""&&e.requesttype.indexOf("Data")>=0&&(e.data_table.fnClearTable(),e.doclear=!1),e.requesttype==="HistoryRequest"||e.requesttype==="HistoryData"?e.requesttype="HistoryData":e.requesttype="NewData",n!=null&&n.alarmvalues!=null&&e.update_data(n.alarmvalues),e.callback!=null&&e.callback(e,n);break}}return OPC.clean_callback(t),!0}}(e.cid),error:function(e){return OPC.log("REFRESH ERROR: "+e.status+", "+e.statusText)}}),!0},e.init_alarms=function(){var e,t,n,r,i,s,o;n=[],o=OPC.alarm_bindings;for(i=0,s=o.length;i<s;i++){e=o[i],r=$("#"+e.alarmid,OPC.root_elem);if(r==null||r.length===0||r.dataTable==null)continue;t=new OPC.Alarm.Binding(e),n.push(t)}return OPC.alarm_bindings=n,n},e.data_order=["NetworkNode","AlarmID","AlarmType","Group","Priority","Text","Active","Acked","TimeDelay","AlarmValue","AlarmLimit","ClearedValue","AlarmDateTime","ClearedDateTime","AckedDateTime","AckedUser","Units","Document","Comment","OKToDelete","OKToComment"],e.data_idx=function(e){var t,n,r,i,s;s=this.data_order;for(n=r=0,i=s.length;r<i;n=++r){t=s[n];if(t===e)return n}return-1},e}(),OPC.Alarm.Binding=function(){function e(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this;this.row_callback=function(t,n,r,i){return e.prototype.row_callback.apply(b,arguments)},this.alarmid=t.alarmid!=null?t.alarmid:"missing_alarmid",this.showProcessing=t.showProcessing!=null?t.showProcessing:!0,this.pagination=t.pagination!=null?t.pagination:!1,this.pageLength=t.pageLength!=null?t.pageLength:10,this.disableAlarmAckOnDoubleClick=t.disableAlarmAckOnDoubleClick!=null?t.disableAlarmAckOnDoubleClick:!1,this.showDelete=t.showDelete!=null?t.showDelete:!0,this.showComment=t.showComment!=null?t.showComment:!1,this.showSearch=t.showSearch!=null?t.showSearch:!0,this.showHistory=t.showHistory!=null?t.showHistory:!1,this.showInfo=t.showInfo?t.showInfo:!0,this.filter=OPC.Alarm.Binding.default_filter,t.filter!=null&&(t.filter.includealarmactive!=null&&(this.filter.includealarmactive=t.filter.includealarmactive
),t.filter.includealarmactiveacked!=null&&(this.filter.includealarmactiveacked=t.filter.includealarmactiveacked),t.filter.includealarmnotactive!=null&&(this.filter.includealarmnotactive=t.filter.includealarmnotactive),t.filter.includealarmnotactivenotacked!=null&&(this.filter.includealarmnotactivenotacked=t.filter.includealarmnotactivenotacked),t.filter.maxpriority!=null&&(this.filter.maxpriority=t.filter.maxpriority),t.filter.minpriority!=null&&(this.filter.minpriority=t.filter.minpriority),t.filter.alarmgroups!=null&&(this.filter.alarmgroups=t.filter.alarmgroups),t.filter.alarmtypes!=null&&(this.filter.alarmtypes=t.filter.alarmtypes)),this.columns=OPC.Alarm.Binding.default_columns;if(t.columns!=null){this.columns=t.columns,a=!1,u=!1,o=!1,f=this.default_column_by_name("AlarmID"),r=this.default_column_by_name("Active"),n=this.default_column_by_name("Acked"),m=this.columns;for(l=0,p=m.length;l<p;l++){i=m[l],i.name.toLowerCase()==="alarmid"&&(a=!0),i.name.toLowerCase()==="active"&&(u=!0),i.name.toLowerCase()==="acked"&&(o=!0),g=OPC.Alarm.Binding.default_columns;for(c=0,d=g.length;c<d;c++){s=g[c];if(i.name.toLowerCase()===s.name.toLowerCase()){i.name=s.name,i.text=i.text!=null?i.text:s.text,i.type=i.type!=null?i.type:s.type,i.visible=i.visible!=null?i.visible:!0,i.width=i.width!=null?i.width:s.width,i.align=i.align!=null?i.align:s.align,i.searchable=i.searchable!=null?i.searchable:s.searchable,i.sortable=i.sortable!=null?i.sortable:s.sortable;break}}}a||(f.visible=!1,this.columns.push(f)),u||(r.visible=!1,this.columns.push(r)),o||(n.visible=!1,this.columns.push(n))}y=this.columns;for(h=0,v=y.length;h<v;h++)i=y[h],i.name==="OKToDelete"&&i.visible==null&&(i.visible=this.showDelete),i.name==="OKToComment"&&i.visible==null&&(i.visible=this.showComment);this.networkNodes=t.networkNodes!=null?t.networkNodes:[],this.dateTimeFormat="mm/dd/yyyy hh:MM aa",this.dateTimeHistorySelectionFormat="MM/dd/yyyy HH:mm:ss",this.callback=t.callback,this.rowClickCallback=t.rowClickCallback,this.height=t.height,this.backlog=[],this.updating=!0,this.draw_table()}return e.default_font={"font-family":"Helvetica, Arial, sans-serif","font-size":"12px","font-weight":"normal"},e.default_font_bold={"font-family":e.default_font["font-family"],"font-size":e.default_font["font-size"],"font-weight":"bold"},e.default_filter={includealarmactive:!0,includealarmactiveacked:!0,includealarmnotactive:!0,includealarmnotactivenotacked:!1,maxpriority:1e6,minpriority:0,alarmgroups:[],alarmtypes:["Digital","High","High High","Low","Low Low","Operator Event","ROC","System","Tag Event"]},e.default_columns=[{name:"AlarmID",text:"Alarm ID",type:"string",visible:!1},{name:"AlarmDateTime",text:"Alarm Date/Time",type:"datetime",visible:!0,sort:"desc",width:"130px",searchable:!1},{name:"Active",text:"Active",type:"boolean",visible:!0,width:"50px",align:"center"},{name:"AlarmValue",text:"Alarm Value",type:"string",visible:!0,align:"right"},{name:"Text",text:"Text",type:"string",visible:!0},{name:"AlarmType",text:"Alarm Type",type:"string",visible:!0},{name:"Group",text:"Group",type:"string",visible:!0},{name:"Priority",text:"Priority",type:"string",visible:!0,width:"50px",align:"right"},{name:"AckedDateTime",text:"Acked Date/Time",type:"datetime",visible:!0},{name:"Acked",text:"Acked",type:"boolean",visible:!0},{name:"AckedUser",text:"Acked User",type:"string",visible:!1},{name:"ClearedDateTime",text:"Cleared Date/Time",type:"datetime",visible:!1},{name:"ClearedValue",text:"Cleared Value",type:"string",visible:!1},{name:"NetworkNode",text:"Network Node",type:"string",visible:!1},{name:"Units",text:"Units",type:"string",visible:!1},{name:"TimeDelay",text:"Delay Time",type:"string",visible:!1},{name:"Document",text:"Document",type:"string",width:"50px",align:"center",visible:!1,searchable:!1,sortable:!1},{name:"Comment",text:"",type:"string",visible:!1,searchable:!1,sortable:!1},{name:"OKToComment",text:"Comment",type:"string",width:"50px",align:"center",searchable:!1,sortable:!1},{name:"OKToDelete",text:"Delete",type:"string",width:"50px",align:"center",searchable:!1,sortable:!1}],e.prototype.default_column_by_name=function(e){var t,n,r,i;i=OPC.Alarm.Binding.default_columns;for(n=0,r=i.length;n<r;n++){t=i[n];if(e.toLowerCase()===t.name.toLowerCase())return t}return null},e.prototype.draw_table=function(){var e,t,n,r,i,s,o,u,a,f,l=this;this.container=$("#"+this.alarmid,OPC.root_elem);if(this.container==null||this.container.length===0)return OPC.log("Missing alarm container #"+this.alarmid),!1;this.container.empty(),this.table=$("<table id='"+this.alarmid+"_tbl' width='100%' class='opc-alarm'></table>"),this.container.append(this.table),this.columns==null&&(this.columns=[]),i=[],o=[],f=this.columns;for(t=u=0,a=f.length;u<a;t=++u)r=f[t],e={sTitle:r.text!=null?r.text:r.name,bVisible:r.visible!=null?r.visible:!1,bSortable:r.sortable!=null?r.sortable:!0,bSearchable:r.searchable!=null?r.searchable:!0,sWidth:r.width!=null?r.width:null},n="",r.align!=null&&(n+=" "+r.align),n!==""&&(e.sClass=n),i.push(e),r.sort!=null&&o.push([t,r.sort]);return s={fnRowCallback:this.row_callback,aaSorting:o,aoColumns:i,bScrollCollapse:!0,iDisplayLength:this.pageLength,bPaginate:this.pagination,bProcessing:this.showProcessing,bAutoWidth:!1,bFilter:this.showSearch!=null?this.showSearch:!1,bInfo:this.showInfo!=null?this.showInfo:!1},this.height!=null&&(s.sScrollY=this.height,s.bPaginate=!1,s.bScrollCollapse=!0),this.data_table=this.table.dataTable(s),this.showHistory&&(this.history_container=$("<div class='history-container'><span class='history-label'>Alarm History Start:</span></div>"),$(this.data_table).parent().prepend(this.history_container),this.history_start=$("<input type='text' id='history_start' placeholder='mm/dd/yyyy hh:mm am/pm'></input>"),this.history_end=$("<input type='text' id='history_end' placeholder='mm/dd/yyyy hh:mm am/pm'></input>"),this.history_go=$("<button id='history_go'>GO</button>"),this.history_container.append(this.history_start),this.history_container
.append($("<span class='history-label'>End:</span> ")),this.history_container.append(this.history_end),this.history_container.append(this.history_go),this.history_go.click(function(e){var t,n;if(l.history_go.hasClass("history"))return l.history_go.removeClass("history"),$("input[type=text], span",l.history_container).show(),l.history_go.html("GO"),OPC.Alarm.get_realtime(l);l.history_start.removeClass("err"),l.history_end.removeClass("err"),n=Date.parse(l.history_start.val()),t=Date.parse(l.history_end.val()),isNaN(n)?l.history_start.addClass("err"):n=new Date(n),isNaN(t)?l.history_end.addClass("err"):t=new Date(t);if(!l.history_start.hasClass("err")&&!l.history_end.hasClass("err"))return l.history_go.addClass("history"),$("input[type=text], span",l.history_container).hide(),l.history_go.html("Resume Real Time Alarms"),OPC.Alarm.get_history(l,l.history_start.val(),l.history_end.val())})),!0},e.prototype.row_callback=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;s=t[this.column_idx("Active")],i=t[this.column_idx("Acked")],b=t[this.column_idx("AlarmType")],y=b==="Tag Event",m=b==="Operator Event",u="active",s||(u="not-"+u),i&&(u+="-acked"),y&&(u="tag-event"),m&&(u="operator-event"),$(e).removeClass("active").removeClass("not-active").removeClass("active-acked").removeClass("not-active-acked"),$(e).removeClass("operator-event").removeClass("tag-event"),$(e).addClass(u),p=0,d=t[this.column_idx("OKToComment")],d=d!=null&&d.toLowerCase()==="true"?!0:!1,v=t[this.column_idx("OKToDelete")],v=v!=null&&v.toLowerCase()==="true"?!0:!1,x=this.columns;for(E=0,S=x.length;E<S;E++){o=x[E];if(!o.visible)continue;w=t[this.column_idx(o.name)],o.type==="boolean"?(l=w?"fa-check-square-o":"fa-square-o",$("td:eq("+p+")",e).html("<i class='fa "+l+"'></i>")):o.type==="datetime"&&(g="",l="",w!=null&&w!==""&&(g=w.getTime(),l=OPC.Util.formatDate(w,this.dateTimeFormat)),$("td:eq("+p+")",e).html("<span class='hide'>"+g+"</span>"+l)),o.name==="Document"?(c=w!=null?w:"#",h=w!=null&&w!==""?"file-o":"",$("td:eq("+p+")",e).html("<a href='"+c+"' target='_blank'><i class='fa fa-"+h+"'></i></a>")):o.name==="OKToComment"?(a=d?"":"disabled",h=w!=null&&w!==""?"comment":"comment-o",$("td:eq("+p+")",e).html("<a href='#' title='View/Edit Alarm Comments' class='comment-row "+a+"'><i class='fa fa-"+h+" "+a+"'></i></a>")):o.name==="OKToDelete"?(f=v?"":"disabled",$("td:eq("+p+")",e).html("<a href='#' title='Delete Alarm' class='delete-row "+f+"'><i class='fa fa-times-circle "+f+"'></i></a>"),$("td:eq("+p+")",e).attr("title","Delete Alarm")):$("td:eq("+p+")",e).attr("title",w),p++}return e},e.prototype.rearrange_data_row=function(e){var t,n,r,i,s,o,u;r=new Array(this.columns.length),u=OPC.Alarm.data_order;for(n=s=0,o=u.length;s<o;n=++s)t=u[n],i=this.column_idx(t),i>=0&&(r[i]=e[n]);return this.convert_data_row(r)},e.prototype.convert_data_row=function(e){var t,n,r,i,s,o;o=this.columns;for(n=i=0,s=o.length;i<s;n=++i)t=o[n],t.type==="boolean"&&(r=e[n]!=null&&e[n]!==""?e[n].toLowerCase():!1,r=r==="true",e[n]=r),t.type==="datetime"&&(r=e[n]!=null&&e[n]!==""?e[n].toLowerCase():0,r=new Date(parseInt(r)),r!==""&&r.getTime()<=0&&(r=""),e[n]=r);return e},e.prototype.set_updating=function(e){var t,n,r,i;if(this.updating===e)return!1;this.updating=e;if(e){i=this.backlog;for(n=0,r=i.length;n<r;n++)t=i[n],this.update_data(t);return this.backlog=[]}},e.prototype.update_data=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;if(e==null||e.length===0)return!1;a=this.column_idx("AlarmID"),o=OPC.Alarm.data_idx("AlarmID");if(!this.updating)return this.backlog.push(e),!1;n=this.data_table.fnGetData();for(d=0,m=e.length;d<m;d++){i=e[d],s=i[o],c=i[OPC.Alarm.data_idx("Text")],u=!this.check_filters(i);if(c==="DELETEALARM")continue;f=this.rearrange_data_row(i),h=!1,l=null,p=null;for(r=v=0,g=n.length;v<g;r=++v){t=n[r];if(t[a]===s){h=!0,u?l=r:p=r;break}}l!=null?(this.data_table.fnDeleteRow(l),n=this.data_table.fnGetData()):h?this.data_table.fnUpdate(f,r):u||this.data_table.fnAddData([f])}this.set_handlers();if(this.callback!=null)return this.callback(this,e)},e.prototype.check_filters=function(e){var t,n,r,i,s,o;return i=this.column_idx("AlarmID"),r=OPC.Alarm.data_idx("AlarmID"),n=e[OPC.Alarm.data_idx("Active")]==="True",t=e[OPC.Alarm.data_idx("Acked")]==="True",s=e[OPC.Alarm.data_idx("Priority")],s=s!=null&&s!==""?parseInt(s):0,o=!0,this.filter.includealarmactive!=null&&n&&(o=o&&this.filter.includealarmactive&&n),this.filter.includealarmactiveacked!=null&&n&&t&&(o=o&&this.filter.includealarmactiveacked&&n&&t),this.filter.includealarmnotactive!=null&&!n&&(o=o&&this.filter.includealarmnotactive&&!n),this.filter.includealarmnotactivenotacked!=null&&!n&&!t&&(o=o&&this.filter.includealarmnotactivenotacked&&!n&&!t),o=o&&s<=this.filter.maxpriority,o=o&&s>=this.filter.minpriority,o},e.prototype.set_handlers=function(){var e;return e=this,$("tbody tr").off("click"),$("tbody tr").on("click",function(t){var n,r,i,s,o,u=this;return this.clicks==null&&(this.clicks=0),++this.clicks,this.clicks===2&&(this.clicks=0,r=e.data_table.fnGetPosition(this),n=e.data_table.fnGetData(r),i=e.alarm_id(n),o=e.network_node(n),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),OPC.Alarm.send_update(e,i,o,"Ack"),e.rowClickCallback!=null&&e.rowClickCallback(n)),s=function(){return u.clicks=0},setTimeout(s,500)}),$("a.comment-row",this.table).off("click"),$("a.comment-row",this.table).click(function(t){var n,r,i,s,o,u,a,f,l,c,h=this;return $(t.target).hasClass("disabled")?!1:(c=$(this).closest("tr"),!c||c.length===0?!1:(r=e.data_table.fnGetPosition(c[0]),n=e.data_table.fnGetData(r),i=e.alarm_id(n),l=e.network_node(n),u=e.value_for(n,"OKToComment"),u=u.toLowerCase()==="true"?!0:!1,o="				<label>Current comments on this Alarm:</label>				<div class='old-comments'>"+e.value_for(n,"Comment")+"</div>			",s=[{text:"CANCEL"}],u&&(o+="<label>Add new comment(s):</label><textarea class='new-comment'></textarea>",s
.push({text:"SAVE",click:function(t){var n;n=$("textarea.new-comment",t.dialog).val().trim();if(n!=="")return OPC.Alarm.send_update(e,i,l,"Comment",n)}})),a={title:"View/Add Alarm Comments",show_input:!0,cls:"comment-dialog",contents:o,buttons:s},f=new OPC.Modal(a),!1))}),$("a.delete-row",this.table).off("click"),$("a.delete-row",this.table).click(function(t){var n,r,i,s,o;return $(t.target).hasClass("disabled")?!1:(o=$(this).closest("tr"),!o||o.length===0?!1:(r=e.data_table.fnGetPosition(o[0]),n=e.data_table.fnGetData(r),i=e.alarm_id(n),s=e.network_node(n),OPC.Alarm.send_update(e,i,s,"Delete"),e.data_table.fnDeleteRow(r),!1))})},e.prototype.column_idx=function(e){var t,n,r,i,s;s=this.columns;for(n=r=0,i=s.length;r<i;n=++r){t=s[n];if(t.name===e)return n}return-1},e.prototype.value_for=function(e,t){return e[this.column_idx(t)]},e.prototype.alarm_id=function(e){return this.value_for(e,"AlarmID")},e.prototype.network_node=function(e){return this.value_for(e,"NetworkNode")},e}()}.call(this);
